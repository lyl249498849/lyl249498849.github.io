<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-我的第一篇博客" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/29/我的第一篇博客/" class="article-date">
  <time datetime="2018-11-29T13:29:53.437Z" itemprop="datePublished">2018-11-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h1><h2 id="1-AJAX概述"><a href="#1-AJAX概述" class="headerlink" title="1.AJAX概述"></a>1.AJAX概述</h2><blockquote>
<p>Web 程序最初的目的就是将信息（数据）放到公共的服务器，让所有网络用户都可以通过浏览器访问。</p>
</blockquote>
<p><img src="E:/liu/%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/%E8%80%81%E5%B8%88%E7%AC%94%E8%AE%B0/sql-ajax-json%E6%A8%A1%E5%9E%8B%E5%B1%82%E7%AD%89/media/a1.png" alt=""></p>
<p>​    </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.在此之前，我们可以通过以下几种方式让浏览器发出对服务端的请求，获得服务端的数据：</span></span><br><span class="line">	地址栏输入地址，回车，刷新</span><br><span class="line">	特定元素的 href 或 src 属性</span><br><span class="line">	表单提交</span><br><span class="line">    a标签</span><br><span class="line"><span class="comment">//2.这些方案都是我们无法通过或者很难通过代码的方式进行编程（对服务端发出请求并且接受服务端返回的响应）</span></span><br><span class="line"><span class="comment">//3.如果我们可以通过JavaScript直接发送网络请求，那么Web的可能就会更多，随之能够实现的功能也会更多，至少不再是“单机游戏”。</span></span><br></pre></td></tr></table></figure>
<p>​    AJAX（Asynchronous JavaScript and XML），是指使用JavaScript和XML进行<strong>异步刷新局部网页的技术</strong>。不是一种新的编程语言，是基于JavaScript、XML、HTML、CSS新用法。它使我们可以通过 JavaScript 直接获取服务端最新的内容而不必重新加载页面。让Web更能接近桌面应用的用户体验。</p>
<p>​    说白了，AJAX 就是浏览器提供的一套 API，可以通过 JavaScript 调用，从而实现通过代码控制请求与响应。实现网络编程。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步(web1.0)：请求1--&gt;等待--&gt;响应1--&gt;请求2--&gt;等待--&gt;响应2…</span></span><br><span class="line"><span class="comment">//异步(web2.0): 请求1--&gt;请求2--&gt;请求3--&gt;响应1--&gt;响应2--&gt;响应3(局部刷新页面)</span></span><br></pre></td></tr></table></figure>
<h2 id="2-快速上手"><a href="#2-快速上手" class="headerlink" title="2.快速上手"></a>2.快速上手</h2><h3 id="2-1-Ajax核心概念"><a href="#2-1-Ajax核心概念" class="headerlink" title="2.1 Ajax核心概念"></a>2.1 Ajax核心概念</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.JavaScript：更新局部的网页</span></span><br><span class="line"><span class="comment">//2.XML：一般用于请求数据和响应数据的封装(一般现在用JSON多)</span></span><br><span class="line"><span class="comment">//3.XMLHttpRequest对象（浏览器的内置对象）</span></span><br><span class="line">	(非IE浏览器：XMLHttpRequest)</span><br><span class="line">	(IE7以后XMLHttpRequest   IE7之前:ActiveXObject) </span><br><span class="line"><span class="comment">//4.异步：发送请求后不等返回结果，由回调函数处理结果</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-快速使用"><a href="#2-2-快速使用" class="headerlink" title="2.2 快速使用"></a>2.2 快速使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Ajax的常用方法和属性</span></span><br><span class="line"><span class="comment">//1 发送Ajax请求</span></span><br><span class="line">	open(method,url,<span class="keyword">async</span>) 与服务器建立连接(请求方式、请求url、是否需要异步)</span><br><span class="line">	send(content)  发送请求,content为请求参数 </span><br><span class="line">	setRequestHeader(header,value)  设置请求头</span><br><span class="line"></span><br><span class="line"><span class="comment">//2 请求回调</span></span><br><span class="line">	onreadystatechange：指定回调函数</span><br><span class="line">	readyState:  指XMLHttpRequest的状态信息  </span><br><span class="line">    status：HTTP的状态码   <span class="number">200</span>   <span class="number">403</span>(没有访问权限)   <span class="number">404</span>   <span class="number">500</span></span><br><span class="line">	responseText：获得响应的文本 </span><br><span class="line">	responseXML：获得响应的XML文档</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//案例：使用ajax获取时间</span></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="comment">//1.获取Ajax核心对象</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createAJAX</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> xmlhttp;</span><br><span class="line">        <span class="comment">//IE7+  Firefox chrome  Opera Safari</span></span><br><span class="line">        <span class="keyword">if</span>(window.XMLHttpRequest)&#123;</span><br><span class="line">            xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//IE5  IE6</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            xmlhttp = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">//也可以这样写</span></span><br><span class="line">     <span class="comment">//var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//2. 获取一个 XMLHttpRequest 类型的对象 —— 相当于打开了一个浏览器</span></span><br><span class="line">	<span class="keyword">var</span> xhr = createAJAX();</span><br><span class="line">    <span class="comment">//3. 打开与一个网址之间的连接 —— 相当于在地址栏输入访问地址</span></span><br><span class="line">    xhr.open(<span class="string">'GET'</span>, <span class="string">'./time.php'</span>)</span><br><span class="line">    <span class="comment">//4. 通过连接发送一次请求 —— 相当于回车或者点击访问发送请求</span></span><br><span class="line">    xhr.send(<span class="keyword">null</span>)</span><br><span class="line">    <span class="comment">//5. 指定 xhr 状态变化事件处理函数 —— 相当于处理网页呈现后的操作</span></span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    	<span class="comment">//6.通过 xhr 的 readyState 判断此次请求的响应是否接收完成</span></span><br><span class="line">    	<span class="keyword">if</span> (this.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">       	 	<span class="comment">// 通过 xhr 的 responseText 获取到响应的响应体</span></span><br><span class="line">        	console.log(this);</span><br><span class="line">   		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//time.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> time();</span><br></pre></td></tr></table></figure>
<h3 id="2-3-readyState-状态描述说明"><a href="#2-3-readyState-状态描述说明" class="headerlink" title="2.3 readyState 状态描述说明"></a>2.3 readyState 状态描述说明</h3><p>​    由于 readystatechange 事件是在 xhr 对象状态变化时触发（不单是在得到响应时），也就意味着这个事件会被触发多次，所以我们有必要了解每一个状态值代表的含义：</p>
<p><img src="E:/liu/%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/%E8%80%81%E5%B8%88%E7%AC%94%E8%AE%B0/sql-ajax-json%E6%A8%A1%E5%9E%8B%E5%B1%82%E7%AD%89/media/d2.png" alt=""></p>
<h3 id="2-4-时间轴"><a href="#2-4-时间轴" class="headerlink" title="2.4. 时间轴"></a>2.4. 时间轴</h3><p><img src="E:/liu/%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/%E8%80%81%E5%B8%88%E7%AC%94%E8%AE%B0/sql-ajax-json%E6%A8%A1%E5%9E%8B%E5%B1%82%E7%AD%89/media/a2.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">console.log(xhr.readyState)</span><br><span class="line"><span class="comment">// =&gt; 0</span></span><br><span class="line"><span class="comment">// 初始化 请求代理对象</span></span><br><span class="line">    </span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'time.php'</span>)</span><br><span class="line">console.log(xhr.readyState)</span><br><span class="line"><span class="comment">// =&gt; 1</span></span><br><span class="line"><span class="comment">// open 方法已经调用，建立一个与服务端特定端口的连接</span></span><br><span class="line">    </span><br><span class="line">xhr.send()</span><br><span class="line">xhr.addEventListener(<span class="string">'readystatechange'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">switch</span> (this.readyState) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="comment">// =&gt; 2</span></span><br><span class="line">            <span class="comment">// 已经接受到了响应报文的响应头</span></span><br><span class="line">            <span class="comment">// 可以拿到头</span></span><br><span class="line">            <span class="comment">// console.log(this.getAllResponseHeaders())</span></span><br><span class="line">            console.log(this.getResponseHeader(<span class="string">'server'</span>))</span><br><span class="line">            <span class="comment">// 但是还没有拿到体</span></span><br><span class="line">            console.log(this.responseText)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="comment">// =&gt; 3</span></span><br><span class="line">            <span class="comment">// 正在下载响应报文的响应体，有可能响应体为空，也有可能不完整</span></span><br><span class="line">            <span class="comment">// 在这里处理响应体不保险（不可靠）</span></span><br><span class="line">            console.log(this.responseText)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="comment">// =&gt; 4</span></span><br><span class="line">            <span class="comment">// 一切 OK （整个响应报文已经完整下载下来了）</span></span><br><span class="line">            <span class="comment">// 这里处理响应体</span></span><br><span class="line">            console.log(this.responseText)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>​    通过理解每一个状态值的含义得出一个结论：一般我们都是在 readyState 值为 4 时，执行响应的后续逻辑。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (this.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">		<span class="comment">// 后续逻辑......</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-遵循-HTTP"><a href="#2-5-遵循-HTTP" class="headerlink" title="2.5. 遵循 HTTP"></a>2.5. 遵循 HTTP</h3><p>​    本质上 XMLHttpRequest 就是 JavaScript 在 Web 平台中发送 HTTP 请求的手段，所以我们发送出去的请求仍然是HTTP 请求，同样符合 HTTP 约定的格式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置请求报文的请求行</span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'./time.php'</span>)</span><br><span class="line"><span class="comment">// 设置请求头</span></span><br><span class="line">xhr.setRequestHeader(<span class="string">'Accept'</span>, <span class="string">'text/plain'</span>)</span><br><span class="line"><span class="comment">// 设置请求体</span></span><br><span class="line">xhr.send(<span class="keyword">null</span>)</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (this.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">		<span class="comment">// 获取响应状态码</span></span><br><span class="line">		console.log(this.status)</span><br><span class="line">		<span class="comment">// 获取响应状态描述</span></span><br><span class="line">		console.log(this.statusText)</span><br><span class="line">		<span class="comment">// 获取响应头信息</span></span><br><span class="line">		console.log(this.getResponseHeader(<span class="string">'Content‐Type'</span>)) <span class="comment">// 指定响应头</span></span><br><span class="line">		console.log(this.getAllResponseHeaders()) <span class="comment">// 全部响应头</span></span><br><span class="line">		<span class="comment">// 获取响应体</span></span><br><span class="line">		console.log(this.responseText) <span class="comment">// 文本形式</span></span><br><span class="line">		<span class="comment">//console.log(this.responseXML) // XML 形式，了解即可</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考链接：<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest</a></p>
<h2 id="3-具体用法"><a href="#3-具体用法" class="headerlink" title="3.具体用法"></a>3.具体用法</h2><h3 id="3-1-GET-请求返回用户数据"><a href="#3-1-GET-请求返回用户数据" class="headerlink" title="3.1. GET 请求返回用户数据"></a>3.1. GET 请求返回用户数据</h3><p>​    通常在一次 GET 请求过程中，参数传递都是通过 URL 地址中的 ? 参数传递。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul id=<span class="string">"list"</span>&gt;&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> listElement = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>)</span><br><span class="line"><span class="comment">// 发送请求获取列表数据呈现在页面</span></span><br><span class="line"><span class="comment">// =======================================</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'users.php'</span>);</span><br><span class="line">xhr.send();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(<span class="keyword">this</span>.responseText)</span><br><span class="line">    <span class="comment">// data =&gt; 数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> liElement = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>)</span><br><span class="line">        liElement.innerHTML = data[i].name</span><br><span class="line">        liElement.id = data[i].id</span><br><span class="line">        listElement.appendChild(liElement)</span><br><span class="line">        liElement.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 通过AJAX操作获取服务端对应数据的信息</span></span><br><span class="line">            <span class="comment">// 如何获取当前被点击元素对应的数据的ID</span></span><br><span class="line">            <span class="comment">// console.log(this.id)</span></span><br><span class="line">            <span class="keyword">var</span> xhr1 = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">            xhr1.open(<span class="string">'GET'</span>, <span class="string">'users.php?id='</span> + <span class="keyword">this</span>.id)</span><br><span class="line">            xhr1.send()</span><br><span class="line">            xhr1.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(<span class="keyword">this</span>.responseText)</span><br><span class="line">                alert(obj.age)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//users.php</span></span><br><span class="line">&lt;?php</span><br><span class="line">header(<span class="string">'Content-Type: application/json'</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回的响应就是一个 JSON 内容（返回的就是数据）</span></span><br><span class="line"><span class="comment"> * 对于返回数据的地址一般我们称之为接口（形式上是 Web 形式）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// `/users.php?id=1` =&gt; id 为 1 的用户信息</span></span><br><span class="line"></span><br><span class="line">$data = array(</span><br><span class="line">  array(</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="number">1</span>,</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'张三'</span>,</span><br><span class="line">    <span class="string">'age'</span> =&gt; <span class="number">18</span></span><br><span class="line">  ),</span><br><span class="line">  array(</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="number">2</span>,</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'李四'</span>,</span><br><span class="line">    <span class="string">'age'</span> =&gt; <span class="number">20</span></span><br><span class="line">  ),</span><br><span class="line">  array(</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="number">3</span>,</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'二傻子'</span>,</span><br><span class="line">    <span class="string">'age'</span> =&gt; <span class="number">18</span></span><br><span class="line">  ),</span><br><span class="line">  array(</span><br><span class="line">    <span class="string">'id'</span> =&gt; <span class="number">4</span>,</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">'三愣子'</span>,</span><br><span class="line">    <span class="string">'age'</span> =&gt; <span class="number">19</span></span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (empty($_GET[<span class="string">'id'</span>])) &#123;</span><br><span class="line">  <span class="comment">// 没有 ID 获取全部</span></span><br><span class="line">  <span class="comment">// 因为 HTTP 中约定报文的内容就是字符串，而我们需要传递给客户端的信息是一个有结构的数据</span></span><br><span class="line">  <span class="comment">// 这种情况下我们一般采用 JSON 作为数据格式</span></span><br><span class="line">  $json = json_encode($data); <span class="comment">// =&gt; [&#123;"id":1,"name":"张三"&#125;,&#123;...&#125;]</span></span><br><span class="line">  echo $json;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 传递了 ID 只获取一条</span></span><br><span class="line">  foreach ($data <span class="keyword">as</span> $item) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($item[<span class="string">'id'</span>] != $_GET[<span class="string">'id'</span>]) <span class="keyword">continue</span>;</span><br><span class="line">    $json = json_encode($item); <span class="comment">// =&gt; [&#123;"id":1,"name":"张三"&#125;,&#123;...&#125;]</span></span><br><span class="line">    echo $json;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-POST-请求登录案例"><a href="#3-2-POST-请求登录案例" class="headerlink" title="3.2. POST 请求登录案例"></a>3.2. POST 请求登录案例</h3><p>​    POST 请求过程中，都是采用请求体承载需要提交的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.html</span></span><br><span class="line">&lt;style&gt;</span><br><span class="line">#loading &#123;</span><br><span class="line">    display: none;</span><br><span class="line">    position: fixed;</span><br><span class="line">    top: <span class="number">0</span>;</span><br><span class="line">    left: <span class="number">0</span>;</span><br><span class="line">    right: <span class="number">0</span>;</span><br><span class="line">    bottom: <span class="number">0</span>;</span><br><span class="line">    background-color: #555;</span><br><span class="line">    opacity: <span class="number">.5</span>;</span><br><span class="line">    text-align: center;</span><br><span class="line">    line-height: <span class="number">300</span>px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#loading::after &#123;</span><br><span class="line">    content: <span class="string">'加载中...'</span>;</span><br><span class="line">    color : #fff;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div id="loading"&gt;&lt;/</span>div&gt;</span><br><span class="line">  &lt;table border=<span class="string">"1"</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;用户名&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">      &lt;td&gt;&lt;input type="text" id="username"&gt;&lt;/</span>td&gt;</span><br><span class="line">    &lt;<span class="regexp">/tr&gt;</span></span><br><span class="line"><span class="regexp">    &lt;tr&gt;</span></span><br><span class="line"><span class="regexp">      &lt;td&gt;密码&lt;/</span>td&gt;</span><br><span class="line">      &lt;td&gt;&lt;input type="password" id="password"&gt;&lt;/td&gt;</span><br><span class="line">    &lt;<span class="regexp">/tr&gt;</span></span><br><span class="line"><span class="regexp">    &lt;tr&gt;</span></span><br><span class="line"><span class="regexp">      &lt;td&gt;&lt;/</span>td&gt;</span><br><span class="line">      &lt;td&gt;&lt;button id="btn"&gt;登录&lt;/button&gt;&lt;/td&gt;</span><br><span class="line">    &lt;<span class="regexp">/tr&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>table&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">    </span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 找一个合适的时机，做一件合适的事情</span></span><br><span class="line"><span class="regexp">var btn = document.getElementById('btn')</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 1. 获取界面上的元素 value</span></span><br><span class="line"><span class="regexp">var txtUsername = document.getElementById('username')</span></span><br><span class="line"><span class="regexp">var txtPassword = document.getElementById('password')</span></span><br><span class="line"><span class="regexp">var loading = document.getElementById('loading')</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">btn.onclick = function () &#123;</span></span><br><span class="line"><span class="regexp">    loading.style.display = 'block'</span></span><br><span class="line"><span class="regexp">    var username = txtUsername.value</span></span><br><span class="line"><span class="regexp">    var password = txtPassword.value</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ 2. 通过 XHR 发送一个 POST 请求</span></span><br><span class="line"><span class="regexp">    var xhr = new XMLHttpRequest()</span></span><br><span class="line"><span class="regexp">    xhr.open('POST', 'login.php')</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ 设置请求的content-type</span></span><br><span class="line"><span class="regexp">    xhr.setRequestHeader('Content-Type', 'application/</span>x-www-form-urlencoded<span class="string">')</span></span><br><span class="line"><span class="string">    // xhr.send('</span>username=<span class="string">' + username + '</span>&amp;password=<span class="string">' + password)</span></span><br><span class="line"><span class="string">    xhr.send(`username=$&#123;username&#125;&amp;password=$&#123;password&#125;`)</span></span><br><span class="line"><span class="string">    // 3. 根据服务端的反馈 作出界面提示</span></span><br><span class="line"><span class="string">    xhr.onreadystatechange = function () &#123;</span></span><br><span class="line"><span class="string">        if (this.readyState !== 4) return</span></span><br><span class="line"><span class="string">        console.log(this.responseText)</span></span><br><span class="line"><span class="string">        loading.style.display = '</span>none<span class="string">'</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//login.php</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">// 接收用户提交的用户名密码</span></span><br><span class="line"><span class="string">if (empty($_POST['</span>username<span class="string">']) || empty($_POST['</span>password<span class="string">'])) &#123;</span></span><br><span class="line"><span class="string">  // echo ;</span></span><br><span class="line"><span class="string">  //exit退出当前脚本</span></span><br><span class="line"><span class="string">  exit('</span>请提交用户名和密码<span class="string">');</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">// 校验</span></span><br><span class="line"><span class="string">$username = $_POST['</span>username<span class="string">'];</span></span><br><span class="line"><span class="string">$password = $_POST['</span>password<span class="string">'];</span></span><br><span class="line"><span class="string">if ($username === '</span>admin<span class="string">' &amp;&amp; $password === '</span><span class="number">123</span><span class="string">') &#123;</span></span><br><span class="line"><span class="string">  exit('</span>恭喜你<span class="string">');</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">exit('</span>用户名或者密码错误<span class="string">');</span></span><br><span class="line"><span class="string">// 响应</span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-同步与异步"><a href="#3-3-同步与异步" class="headerlink" title="3.3. 同步与异步"></a>3.3. 同步与异步</h3><p>​    xhr.open() 方法第三个参数要求传入的是一个 bool 值，其作用就是设置此次请求是否采用异步方式执行，默认为 true ，如果需要同步执行可以通过传递 false 实现：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">console.log(<span class="string">'before ajax'</span>)</span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"><span class="comment">// 默认第三个参数为 true 意味着采用异步方式执行</span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'./time.php'</span>, <span class="keyword">true</span>)</span><br><span class="line">xhr.send(<span class="keyword">null</span>)</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (this.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">		<span class="comment">// 这里的代码最后执行</span></span><br><span class="line">		console.log(<span class="string">'request done'</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(<span class="string">'after ajax'</span>);</span><br></pre></td></tr></table></figure>
<p>​    如果采用同步方式执行，则代码会卡死在 xhr.send() 这一步：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">console.log(<span class="string">'before ajax'</span>)</span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"><span class="comment">// 同步方式</span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'./time.php'</span>, <span class="keyword">false</span>)</span><br><span class="line"><span class="comment">// 同步方式 执行需要 先注册事件再调用 send，否则 readystatechange 无法触发</span></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (this.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">		<span class="comment">// 这里的代码最后执行</span></span><br><span class="line">		console.log(<span class="string">'request done'</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.send(<span class="keyword">null</span>)</span><br><span class="line">console.log(<span class="string">'after ajax'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">//如果是同步请求，一定在发送请求 send() 之前注册 readystatechange</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-响应数据格式"><a href="#3-4-响应数据格式" class="headerlink" title="3.4. 响应数据格式"></a>3.4. 响应数据格式</h3><p>​    提问：如果希望服务端返回一个复杂数据，该如何处理？<br>​    关心的问题就是服务端发出何种格式的数据，这种格式如何在客户端用 JavaScript 解析。</p>
<h4 id="3-4-1-XML介绍"><a href="#3-4-1-XML介绍" class="headerlink" title="3.4.1. XML介绍"></a>3.4.1. XML介绍</h4><p>​    XML是一种数据格式，xml文件以xml后缀名结尾。xml文件需要使用xml解析器去解析。浏览器内置了xml解析器。(XML这种数据格式目前使用没有JSON多)</p>
<p>​    XML的组成：标签、属性、注释、文档声明</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.XML标签</span></span><br><span class="line">&lt;student&gt;AA&lt;<span class="regexp">/student&gt;  开始标签  标签体内容  结束标签</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">1）&lt;student/</span>&gt; 或 &lt;student&gt;&lt;/student&gt; 空标签。没有标签体内容</span><br><span class="line"><span class="number">2</span>）xml标签名称区分大小写。</span><br><span class="line"><span class="number">3</span>）xml标签一定要正确配对。</span><br><span class="line"><span class="number">4</span>）xml标签名中间不能使用空格</span><br><span class="line"><span class="number">5</span>）xml标签名不能以数字开头</span><br><span class="line"><span class="number">6</span>）注意： 在一个xml文档中，有且仅有一个根标签</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.属性</span></span><br><span class="line">&lt;student name=<span class="string">"eric"</span>&gt;student&lt;<span class="regexp">/student&gt;</span></span><br><span class="line"><span class="regexp">1）属性值必须以引号包含，可以是单引号也可以双引号，但是不能单双引号混用！！！</span></span><br><span class="line"><span class="regexp">2）一个标签内可以有多个属性，但不能出现重复的属性名！！！</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/3.注释</span></span><br><span class="line"><span class="regexp">  &lt;!--  xml注释 --&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/4.文档声明</span></span><br><span class="line"><span class="regexp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="regexp">1) version: xml的版本号</span></span><br><span class="line"><span class="regexp">2) encoding： 解析xml文件时查询的码表（解码过程时查询的码表）</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用xml设计一个通讯录</span></span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;contact&gt;</span><br><span class="line">	&lt;person id=<span class="string">"100"</span>&gt;</span><br><span class="line">		 &lt;name&gt;张三&lt;<span class="regexp">/name&gt;</span></span><br><span class="line"><span class="regexp">		 &lt;age&gt;18&lt;/</span>age&gt;</span><br><span class="line">		 &lt;phone&gt;<span class="number">12345678</span>&lt;<span class="regexp">/phone&gt;</span></span><br><span class="line"><span class="regexp">		 &lt;email&gt;12453@qq.com&lt;/</span>email&gt;</span><br><span class="line">	&lt;<span class="regexp">/person&gt;</span></span><br><span class="line"><span class="regexp">	&lt;person id="101"&gt;</span></span><br><span class="line"><span class="regexp">		 &lt;name&gt;李四&lt;/</span>name&gt;</span><br><span class="line">		 &lt;age&gt;<span class="number">20</span>&lt;<span class="regexp">/age&gt;</span></span><br><span class="line"><span class="regexp">		 &lt;phone&gt;22345678&lt;/</span>phone&gt;</span><br><span class="line">		 &lt;email&gt;<span class="number">34453</span>@qq.com&lt;<span class="regexp">/email&gt;</span></span><br><span class="line"><span class="regexp">	&lt;/</span>person&gt;</span><br><span class="line">&lt;<span class="regexp">/contact&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-2-返回XML"><a href="#3-4-2-返回XML" class="headerlink" title="3.4.2 返回XML"></a>3.4.2 返回XML</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">	xhr.open(<span class="string">'GET'</span>, <span class="string">'xml.php'</span>)</span><br><span class="line">	xhr.send()</span><br><span class="line">	xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    	<span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// this.responseXML 专门用于获取服务端返回的 XML 数据，操作方式就是通过 DOM 的方式操作</span></span><br><span class="line">        <span class="comment">// 但是需要服务端响应头中的 Content-Type 必须是 application/xml</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseXML.documentElement.children[<span class="number">0</span>].innerHTML)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseXML.documentElement.getElementsByTagName(<span class="string">'name'</span>)[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/xml.php</span></span><br><span class="line"><span class="regexp">&lt;?php</span></span><br><span class="line"><span class="regexp">header('Content-Type: application/</span>xml<span class="string">');</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">&lt;?xml version="1.1" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="string">&lt;person&gt;</span></span><br><span class="line"><span class="string">    &lt;name&gt;羊杨&lt;/name&gt;</span></span><br><span class="line"><span class="string">	&lt;age&gt;16&lt;/age&gt;</span></span><br><span class="line"><span class="string">	&lt;gender&gt;男&lt;/gender&gt;</span></span><br><span class="line"><span class="string">&lt;/person&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-3-返回JSON"><a href="#3-4-3-返回JSON" class="headerlink" title="3.4.3.返回JSON"></a>3.4.3.返回JSON</h4><p>​    JSON是一种数据格式，类似于 JavaScript 字面量方式<br>​    服务端采用 JSON 格式返回数据，客户端按照 JSON 格式解析数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;table&gt;</span><br><span class="line">    &lt;tbody id=<span class="string">"content"</span>&gt;&lt;/tbody&gt;</span><br><span class="line">  &lt;<span class="regexp">/table&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script&gt;</span></span><br><span class="line"><span class="regexp">    var xhr = new XMLHttpRequest()</span></span><br><span class="line"><span class="regexp">    xhr.open('GET', 'test.php')</span></span><br><span class="line"><span class="regexp">    xhr.send()</span></span><br><span class="line"><span class="regexp">    xhr.onreadystatechange = function () &#123;</span></span><br><span class="line"><span class="regexp">      if (this.readyState !== 4) return</span></span><br><span class="line"><span class="regexp">      var res = JSON.parse(this.responseText)</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ res =&gt; 服务端返回的数据</span></span><br><span class="line"><span class="regexp">      var data = res.data</span></span><br><span class="line"><span class="regexp">      for (var i = 0; i &lt; data.length; i++) &#123;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ 先创建行</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ 再创建列</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ 再将列添加到行</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ 再将行添加到tbody</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ console.log(data[i])</span></span><br><span class="line"><span class="regexp">        var tr = document.createElement('tr')</span></span><br><span class="line"><span class="regexp">        tr.innerHTML = '&lt;td&gt;' + data[i].id + '&lt;/</span>td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;<span class="string">'</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">header('</span>Content-Type: application/json<span class="string">');</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	"success": true,</span></span><br><span class="line"><span class="string">	"data": [&#123;</span></span><br><span class="line"><span class="string">		"0": "7",</span></span><br><span class="line"><span class="string">		"id": "7",</span></span><br><span class="line"><span class="string">		"1": "哈哈",</span></span><br><span class="line"><span class="string">		"author": "哈哈",</span></span><br><span class="line"><span class="string">		"2": "hh@gmail.com",</span></span><br><span class="line"><span class="string">		"email": "hh@gmail.com",</span></span><br><span class="line"><span class="string">		"3": "2017-07-22 09:10:00",</span></span><br><span class="line"><span class="string">		"created": "2017-07-22 09:10:00",</span></span><br><span class="line"><span class="string">		"4": "一针见血",</span></span><br><span class="line"><span class="string">		"content": "一针见血",</span></span><br><span class="line"><span class="string">		"5": "approved",</span></span><br><span class="line"><span class="string">		"status": "approved",</span></span><br><span class="line"><span class="string">		"6": "1",</span></span><br><span class="line"><span class="string">		"post_id": "1",</span></span><br><span class="line"><span class="string">		"7": null,</span></span><br><span class="line"><span class="string">		"parent_id": null,</span></span><br><span class="line"><span class="string">		"8": "世界，你好",</span></span><br><span class="line"><span class="string">		"post_title": "世界，你好"</span></span><br><span class="line"><span class="string">	&#125;, &#123;</span></span><br><span class="line"><span class="string">		"0": "6",</span></span><br><span class="line"><span class="string">		"id": "6",</span></span><br><span class="line"><span class="string">		"1": "小右",</span></span><br><span class="line"><span class="string">		"author": "小右",</span></span><br><span class="line"><span class="string">		"2": "www@gmail.com",</span></span><br><span class="line"><span class="string">		"email": "www@gmail.com",</span></span><br><span class="line"><span class="string">		"3": "2017-07-11 22:22:00",</span></span><br><span class="line"><span class="string">		"created": "2017-07-11 22:22:00",</span></span><br><span class="line"><span class="string">		"4": "I am fine thank you and you?",</span></span><br><span class="line"><span class="string">		"content": "I am fine thank you and you?",</span></span><br><span class="line"><span class="string">		"5": "approved",</span></span><br><span class="line"><span class="string">		"status": "approved",</span></span><br><span class="line"><span class="string">		"6": "1",</span></span><br><span class="line"><span class="string">		"post_id": "1",</span></span><br><span class="line"><span class="string">		"7": "5",</span></span><br><span class="line"><span class="string">		"parent_id": "5",</span></span><br><span class="line"><span class="string">		"8": "世界，你好",</span></span><br><span class="line"><span class="string">		"post_title": "世界，你好"</span></span><br><span class="line"><span class="string">	&#125;, &#123;</span></span><br><span class="line"><span class="string">		"0": "4",</span></span><br><span class="line"><span class="string">		"id": "4",</span></span><br><span class="line"><span class="string">		"1": "汪磊",</span></span><br><span class="line"><span class="string">		"author": "汪磊",</span></span><br><span class="line"><span class="string">		"2": "www@gmail.com",</span></span><br><span class="line"><span class="string">		"email": "www@gmail.com",</span></span><br><span class="line"><span class="string">		"3": "2017-07-09 22:22:00",</span></span><br><span class="line"><span class="string">		"created": "2017-07-09 22:22:00",</span></span><br><span class="line"><span class="string">		"4": "不好",</span></span><br><span class="line"><span class="string">		"content": "不好",</span></span><br><span class="line"><span class="string">		"5": "approved",</span></span><br><span class="line"><span class="string">		"status": "approved",</span></span><br><span class="line"><span class="string">		"6": "1",</span></span><br><span class="line"><span class="string">		"post_id": "1",</span></span><br><span class="line"><span class="string">		"7": "3",</span></span><br><span class="line"><span class="string">		"parent_id": "3",</span></span><br><span class="line"><span class="string">		"8": "世界，你好",</span></span><br><span class="line"><span class="string">		"post_title": "世界，你好"</span></span><br><span class="line"><span class="string">	&#125;],</span></span><br><span class="line"><span class="string">	"total_count": 3</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="4-模板引擎介绍"><a href="#4-模板引擎介绍" class="headerlink" title="4.模板引擎介绍"></a>4.模板引擎介绍</h2><p>​    模板引擎： <a href="https://github.com/tj/consolidate.js#supported-template-engines" target="_blank" rel="noopener">https://github.com/tj/consolidate.js#supported-template-engines</a><br>​    artTemplate：<a href="https://aui.github.io/art-template/" target="_blank" rel="noopener">https://aui.github.io/art-template/</a></p>
<p>​    模板引擎实际上就是一个 API，模板引擎有很多种，使用方式大同小异，目的为了可以更容易的将数据渲染到HTML中。</p>
<p>​    模板 +　数据　＝　静态代码段</p>
<h3 id="4-1-流行的模板引擎如下："><a href="#4-1-流行的模板引擎如下：" class="headerlink" title="4.1 流行的模板引擎如下："></a>4.1 流行的模板引擎如下：</h3><p><img src="E:/liu/%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/%E8%80%81%E5%B8%88%E7%AC%94%E8%AE%B0/sql-ajax-json%E6%A8%A1%E5%9E%8B%E5%B1%82%E7%AD%89/assets/1539403659842.png" alt="1539403659842"></p>
<h3 id="4-2-为什么要模板引擎"><a href="#4-2-为什么要模板引擎" class="headerlink" title="4.2.为什么要模板引擎"></a>4.2.为什么要模板引擎</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">success</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 这里就相当于之前的回调函数</span></span><br><span class="line">        <span class="keyword">var</span> title = data.title;</span><br><span class="line">        <span class="keyword">var</span> books = data.books;</span><br><span class="line">        <span class="keyword">var</span> tag = <span class="string">'&lt;h1&gt;'</span>+title+<span class="string">'&lt;/h1&gt;'</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;books.length;i++)&#123;</span><br><span class="line">            tag += <span class="string">'&lt;div&gt;'</span>+books[i]+<span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> con = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">        con.innerHTML = tag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">        title : <span class="string">'图书信息'</span>,</span><br><span class="line">        books:[<span class="string">'三国演义'</span>,<span class="string">'水浒传'</span>,<span class="string">'西游记'</span>,<span class="string">'红楼梦'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    success(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//上面通过js代码拼接，如果网页结构比较复杂，可能会有很多的js代码</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-artTemplate基本使用"><a href="#4-3-artTemplate基本使用" class="headerlink" title="4.3.artTemplate基本使用"></a>4.3.artTemplate基本使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>引入模板引擎</span><br><span class="line">  &lt;!--</span><br><span class="line">    script 标签的特点是：如果 type 不等于 text/javascript 的话，内部的内容不会作为 JavaScript 执行</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"./template.js"</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="number">2.</span>定义一个模板</span><br><span class="line">    &lt;script type=<span class="string">"text/html"</span> id=<span class="string">"template"</span>&gt;</span><br><span class="line">        &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &#123;&#123;if books&#125;&#125;</span></span><br><span class="line"><span class="regexp">            &#123;&#123;each books as value i&#125;&#125;</span></span><br><span class="line"><span class="regexp">                &lt;div&gt;&#123;&#123;value&#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">            &#123;&#123;/each&#125;&#125;</span><br><span class="line">        &#123;&#123;/<span class="keyword">if</span>&#125;&#125;</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">3.页面定义一个容器用于接收模板引擎拼接的静态页面</span></span><br><span class="line"><span class="regexp">    &lt;div id="container"&gt;&lt;/</span>div&gt;</span><br><span class="line"><span class="number">4.</span>使用模板引擎渲染数据到html</span><br><span class="line">    &lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">		<span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> data = &#123;</span><br><span class="line">				title : <span class="string">'图书信息'</span>,</span><br><span class="line">				books:[<span class="string">'三国演义'</span>,<span class="string">'水浒传'</span>,<span class="string">'西游记'</span>,<span class="string">'红楼梦'</span>]</span><br><span class="line">			&#125;;</span><br><span class="line">			<span class="comment">// template的作用就是把模板和数据拼接到一块生成一个静态HTML片段，实际就是该方法的返回值</span></span><br><span class="line">			<span class="comment">// 参数一：模板id</span></span><br><span class="line">			<span class="comment">// 参数二：用来渲染的数据</span></span><br><span class="line">			<span class="keyword">var</span> html = template(<span class="string">'template'</span>,data);</span><br><span class="line">			<span class="keyword">var</span> con = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line">			<span class="built_in">console</span>.log(con);</span><br><span class="line">			con.innerHTML = html;</span><br><span class="line">		&#125; </span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-索引的使用"><a href="#4-4-索引的使用" class="headerlink" title="4.4.索引的使用"></a>4.4.索引的使用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">type</span>=<span class="string">"text/html"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      &#123;&#123;<span class="keyword">if</span> isAdmin&#125;&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="javascript">          &#123;&#123;each list <span class="keyword">as</span> value i&#125;&#125;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span>索引 &#123;&#123;i + 1&#125;&#125; ：&#123;&#123;value&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="undefined">          &#123;&#123;/each&#125;&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="javascript">      &#123;&#123;/<span class="keyword">if</span>&#125;&#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> data = &#123;</span></span><br><span class="line"><span class="javascript">	title: <span class="string">'基本例子'</span>,</span></span><br><span class="line"><span class="javascript">	isAdmin: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">	list: [<span class="string">'文艺'</span>, <span class="string">'博客'</span>, <span class="string">'摄影'</span>, <span class="string">'电影'</span>, <span class="string">'民谣'</span>, <span class="string">'旅行'</span>, <span class="string">'吉他'</span>]</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> html = template(<span class="string">'test'</span>, data);</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.getElementById(<span class="string">'content'</span>).innerHTML = html;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-5-转义"><a href="#4-5-转义" class="headerlink" title="4.5.转义"></a>4.5.转义</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">h1</span>&gt;</span>不转义HTML<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">type</span>=<span class="string">"text/html"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>不转义：&#123;&#123;#value&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="comment">&lt;!--#不转义--&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>默认转义： &#123;&#123;value&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">// 这里的数据当中包含特殊字符</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> data = &#123;</span></span><br><span class="line"><span class="xml">		value: '<span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:#F00"</span>&gt;</span>hello world!<span class="tag">&lt;/<span class="name">span</span>&gt;</span>'</span></span><br><span class="line"><span class="undefined">	&#125;;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> html = template(<span class="string">'test'</span>, data);</span></span><br><span class="line"><span class="javascript">	<span class="built_in">document</span>.getElementById(<span class="string">'content'</span>).innerHTML = html;</span></span><br><span class="line"><span class="undefined">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-6-在js中存放模板"><a href="#4-6-在js中存放模板" class="headerlink" title="4.6.在js中存放模板"></a>4.6.在js中存放模板</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> source = <span class="string">'&lt;ul&gt;'</span></span></span><br><span class="line"><span class="javascript">+    <span class="string">'&#123;&#123;each list as value i&#125;&#125;'</span></span></span><br><span class="line"><span class="xml">+        '<span class="tag">&lt;<span class="name">li</span>&gt;</span>索引 &#123;&#123;i + 1&#125;&#125; ：&#123;&#123;value&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>'</span></span><br><span class="line"><span class="javascript">+    <span class="string">'&#123;&#123;/each&#125;&#125;'</span></span></span><br><span class="line"><span class="javascript">+ <span class="string">'&lt;/ul&gt;'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// 根据模板生成渲染函数；compile方法返回值是一个函数</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> render = template.compile(source);</span></span><br><span class="line"><span class="javascript"><span class="comment">// render的作用就是用数据渲染静态标签内容</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> data = &#123;</span></span><br><span class="line"><span class="javascript">	list: [<span class="string">'摄影'</span>, <span class="string">'电影'</span>, <span class="string">'民谣'</span>, <span class="string">'旅行'</span>, <span class="string">'吉他'</span>]</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> html = render(data);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.getElementById(<span class="string">'content'</span>).innerHTML = html;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-7-模板之间的包含"><a href="#4-7-模板之间的包含" class="headerlink" title="4.7.模板之间的包含"></a>4.7.模板之间的包含</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">type</span>=<span class="string">"text/html"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span></span><br><span class="line"><span class="javascript">      &#123;&#123;include <span class="string">'list'</span>&#125;&#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"list"</span> <span class="attr">type</span>=<span class="string">"text/html"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="javascript">          &#123;&#123;each list <span class="keyword">as</span> value i&#125;&#125;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span>索引 &#123;&#123;i + 1&#125;&#125; ：&#123;&#123;value&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="undefined">          &#123;&#123;/each&#125;&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> data = &#123;</span></span><br><span class="line"><span class="javascript">	title: <span class="string">'嵌入子模板'</span>,</span></span><br><span class="line"><span class="javascript">	list: [<span class="string">'文艺'</span>, <span class="string">'博客'</span>, <span class="string">'摄影'</span>, <span class="string">'电影'</span>, <span class="string">'民谣'</span>, <span class="string">'旅行'</span>, <span class="string">'吉他'</span>]</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> html = template(<span class="string">'test'</span>, data);</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.getElementById(<span class="string">'content'</span>).innerHTML = html;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-8-模板引擎处理响应数据渲染"><a href="#4-8-模板引擎处理响应数据渲染" class="headerlink" title="4.8. 模板引擎处理响应数据渲染"></a>4.8. 模板引擎处理响应数据渲染</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;table id=<span class="string">"demo"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line">  &lt;script id=<span class="string">"tmpl"</span> type=<span class="string">"text/x-art-template"</span>&gt;</span><br><span class="line">    &#123;&#123;each comments&#125;&#125;</span><br><span class="line">    &lt;!-- each 内部 $value 拿到的是当前被遍历的那个元素 --&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;&#123;&#123;$value.author&#125;&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">      &lt;td&gt;&#123;&#123;$value.content&#125;&#125;&lt;/</span>td&gt;</span><br><span class="line">      &lt;td&gt;&#123;&#123;$value.created&#125;&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>tr&gt;</span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line">  &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">      </span></span><br><span class="line"><span class="regexp">  &lt;script src="template-web.js"&gt;&lt;/</span>script&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">    xhr.open(<span class="string">'GET'</span>, <span class="string">'test.php'</span>)</span><br><span class="line">    xhr.send()</span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">var</span> res = <span class="built_in">JSON</span>.parse(<span class="keyword">this</span>.responseText)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 模板所需数据</span></span><br><span class="line">      <span class="keyword">var</span> context = &#123; <span class="attr">comments</span>: res.data &#125;</span><br><span class="line">      <span class="comment">// 借助模板引擎的API 渲染数据</span></span><br><span class="line">      <span class="keyword">var</span> html = template(<span class="string">'tmpl'</span>, context)</span><br><span class="line">      <span class="built_in">console</span>.log(html)</span><br><span class="line"></span><br><span class="line">      <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>).innerHTML = html</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//test.php</span></span><br><span class="line">&lt;?php</span><br><span class="line">header(<span class="string">'Content-Type: application/json'</span>);</span><br><span class="line">?&gt;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="string">"data"</span>: [&#123;</span><br><span class="line">		<span class="string">"0"</span>: <span class="string">"7"</span>,</span><br><span class="line">		<span class="string">"id"</span>: <span class="string">"7"</span>,</span><br><span class="line">		<span class="string">"1"</span>: <span class="string">"哈哈"</span>,</span><br><span class="line">		<span class="string">"author"</span>: <span class="string">"哈哈"</span>,</span><br><span class="line">		<span class="string">"2"</span>: <span class="string">"hh@gmail.com"</span>,</span><br><span class="line">		<span class="string">"email"</span>: <span class="string">"hh@gmail.com"</span>,</span><br><span class="line">		<span class="string">"3"</span>: <span class="string">"2017-07-22 09:10:00"</span>,</span><br><span class="line">		<span class="string">"created"</span>: <span class="string">"2017-07-22 09:10:00"</span>,</span><br><span class="line">		<span class="string">"4"</span>: <span class="string">"一针见血"</span>,</span><br><span class="line">		<span class="string">"content"</span>: <span class="string">"一针见血"</span>,</span><br><span class="line">		<span class="string">"5"</span>: <span class="string">"approved"</span>,</span><br><span class="line">		<span class="string">"status"</span>: <span class="string">"approved"</span>,</span><br><span class="line">		<span class="string">"6"</span>: <span class="string">"1"</span>,</span><br><span class="line">		<span class="string">"post_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">		<span class="string">"7"</span>: <span class="literal">null</span>,</span><br><span class="line">		<span class="string">"parent_id"</span>: <span class="literal">null</span>,</span><br><span class="line">		<span class="string">"8"</span>: <span class="string">"世界，你好"</span>,</span><br><span class="line">		<span class="string">"post_title"</span>: <span class="string">"世界，你好"</span></span><br><span class="line">	&#125;, &#123;</span><br><span class="line">		<span class="string">"0"</span>: <span class="string">"6"</span>,</span><br><span class="line">		<span class="string">"id"</span>: <span class="string">"6"</span>,</span><br><span class="line">		<span class="string">"1"</span>: <span class="string">"小右"</span>,</span><br><span class="line">		<span class="string">"author"</span>: <span class="string">"小右"</span>,</span><br><span class="line">		<span class="string">"2"</span>: <span class="string">"www@gmail.com"</span>,</span><br><span class="line">		<span class="string">"email"</span>: <span class="string">"www@gmail.com"</span>,</span><br><span class="line">		<span class="string">"3"</span>: <span class="string">"2017-07-11 22:22:00"</span>,</span><br><span class="line">		<span class="string">"created"</span>: <span class="string">"2017-07-11 22:22:00"</span>,</span><br><span class="line">		<span class="string">"4"</span>: <span class="string">"I am fine thank you and you?"</span>,</span><br><span class="line">		<span class="string">"content"</span>: <span class="string">"I am fine thank you and you?"</span>,</span><br><span class="line">		<span class="string">"5"</span>: <span class="string">"approved"</span>,</span><br><span class="line">		<span class="string">"status"</span>: <span class="string">"approved"</span>,</span><br><span class="line">		<span class="string">"6"</span>: <span class="string">"1"</span>,</span><br><span class="line">		<span class="string">"post_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">		<span class="string">"7"</span>: <span class="string">"5"</span>,</span><br><span class="line">		<span class="string">"parent_id"</span>: <span class="string">"5"</span>,</span><br><span class="line">		<span class="string">"8"</span>: <span class="string">"世界，你好"</span>,</span><br><span class="line">		<span class="string">"post_title"</span>: <span class="string">"世界，你好"</span></span><br><span class="line">	&#125;, &#123;</span><br><span class="line">		<span class="string">"0"</span>: <span class="string">"4"</span>,</span><br><span class="line">		<span class="string">"id"</span>: <span class="string">"4"</span>,</span><br><span class="line">		<span class="string">"1"</span>: <span class="string">"汪磊"</span>,</span><br><span class="line">		<span class="string">"author"</span>: <span class="string">"汪磊"</span>,</span><br><span class="line">		<span class="string">"2"</span>: <span class="string">"www@gmail.com"</span>,</span><br><span class="line">		<span class="string">"email"</span>: <span class="string">"www@gmail.com"</span>,</span><br><span class="line">		<span class="string">"3"</span>: <span class="string">"2017-07-09 22:22:00"</span>,</span><br><span class="line">		<span class="string">"created"</span>: <span class="string">"2017-07-09 22:22:00"</span>,</span><br><span class="line">		<span class="string">"4"</span>: <span class="string">"不好"</span>,</span><br><span class="line">		<span class="string">"content"</span>: <span class="string">"不好"</span>,</span><br><span class="line">		<span class="string">"5"</span>: <span class="string">"approved"</span>,</span><br><span class="line">		<span class="string">"status"</span>: <span class="string">"approved"</span>,</span><br><span class="line">		<span class="string">"6"</span>: <span class="string">"1"</span>,</span><br><span class="line">		<span class="string">"post_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">		<span class="string">"7"</span>: <span class="string">"3"</span>,</span><br><span class="line">		<span class="string">"parent_id"</span>: <span class="string">"3"</span>,</span><br><span class="line">		<span class="string">"8"</span>: <span class="string">"世界，你好"</span>,</span><br><span class="line">		<span class="string">"post_title"</span>: <span class="string">"世界，你好"</span></span><br><span class="line">	&#125;],</span><br><span class="line">	<span class="string">"total_count"</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-封装"><a href="#4-封装" class="headerlink" title="4.封装"></a>4.封装</h2><h3 id="4-1-回调函数"><a href="#4-1-回调函数" class="headerlink" title="4.1 回调函数"></a>4.1 回调函数</h3><p>​    回调函数具体的定义为：函数A作为参数(函数引用)传递到另一个函数B中，并且这个函数B执行函数A。我们就说函数A叫做回调函数。如果没有名称(函数表达式)，就叫做匿名回调函数。</p>
<p>​    因此callback 不一定用于异步，一般同步(阻塞)的场景下也经常用到回调，比如要求执行某些操作后执行回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步回调</span></span><br><span class="line"><span class="keyword">var</span> callback = <span class="function"><span class="keyword">function</span>(<span class="params">arg3</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'callback Totle is:'</span> + arg3)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">arg1, arg2, cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Total = arg1 + arg2;</span><br><span class="line">    cb(Total);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'mainFunction Totle is:'</span> + Total)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn(<span class="number">2</span>, <span class="number">2</span>, callback)   </span><br><span class="line"></span><br><span class="line"><span class="comment">//异步回调</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'f2 finished'</span>) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    setTimeout(cb,<span class="number">1000</span>)        <span class="comment">//用setTimeout()模拟耗时操作</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'f1 finished'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f1(f2);</span><br></pre></td></tr></table></figure>
<h3 id="4-2-AJAX-请求封装"><a href="#4-2-AJAX-请求封装" class="headerlink" title="4.2. AJAX 请求封装"></a>4.2. AJAX 请求封装</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 发送一个 AJAX 请求</span></span><br><span class="line"><span class="comment">* @param &#123;String&#125; method 请求方法</span></span><br><span class="line"><span class="comment">* @param &#123;String&#125; url 请求地址</span></span><br><span class="line"><span class="comment">* @param &#123;Object&#125; params 请求参数</span></span><br><span class="line"><span class="comment">* @param &#123;Function&#125; done 请求完成过后需要做的事情（委托/回调）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">method, url, params, done</span>) </span>&#123;</span><br><span class="line">    method = method.toUpperCase()</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="built_in">window</span>.XMLHttpRequest ? <span class="keyword">new</span> XMLHttpRequest() : <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHTTP'</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> params === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> tempArr = []</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">            <span class="keyword">var</span> value = params[key]</span><br><span class="line">            tempArr.push(key + <span class="string">'='</span> + value)</span><br><span class="line">        &#125;</span><br><span class="line">        params = tempArr.join(<span class="string">'&amp;'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">        url += <span class="string">'?'</span> + params</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.open(method, url, <span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">var</span> data = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">        xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">        data = params</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// 不应该在封装的函数中主观的处理响应结果</span></span><br><span class="line">        <span class="comment">// console.log(this.responseText)</span></span><br><span class="line">        <span class="comment">// 你说我太主观，那么你告诉我应该做什么</span></span><br><span class="line">        done(<span class="keyword">this</span>.responseText)</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.send(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> onDone = <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'做完了'</span>)</span><br><span class="line">&#125;</span><br><span class="line">ajax(<span class="string">'get'</span>, <span class="string">'time.php'</span>, &#123;&#125;, onDone)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//time.php</span></span><br><span class="line">&lt;?php</span><br><span class="line">echo time();</span><br></pre></td></tr></table></figure>
<h3 id="4-3-jQuery-中的-AJAX"><a href="#4-3-jQuery-中的-AJAX" class="headerlink" title="4.3. jQuery 中的 AJAX"></a>4.3. jQuery 中的 AJAX</h3><p>​    jQuery 中有一套专门针对 AJAX 的封装，功能十分完善<br>​    参考：<br>​    <a href="http://www.jquery123.com/category/ajax/" target="_blank" rel="noopener">http://www.jquery123.com/category/ajax/</a><br>​    <a href="http://www.w3school.com.cn/jquery/jquery_ref_ajax.asp" target="_blank" rel="noopener">http://www.w3school.com.cn/jquery/jquery_ref_ajax.asp</a></p>
<h4 id="4-3-1-ajax"><a href="#4-3-1-ajax" class="headerlink" title="4.3.1. $.ajax"></a>4.3.1. $.ajax</h4><p>​    常用选项参数介绍：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">url：请求地址</span><br><span class="line">type：请求方法，默认为 get</span><br><span class="line">dataType：服务端响应数据类型</span><br><span class="line">contentType：请求体内容类型，默认 application/x-www-form-urlencoded</span><br><span class="line">data：需要传递到服务端的数据，如果 GET 则通过 URL 传递，如果 POST 则通过请求体传递</span><br><span class="line">timeout：请求超时时间</span><br><span class="line"></span><br><span class="line">beforeSend：请求发起之前触发</span><br><span class="line">success：请求成功之后触发（响应状态码 <span class="number">200</span>）</span><br><span class="line">error：请求失败触发</span><br><span class="line">complete：请求完成触发（不管成功与否）</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.最基础的调用</span></span><br><span class="line">$.ajax(<span class="string">'./time.php'</span>, &#123;</span><br><span class="line">    type: <span class="string">'post'</span>, <span class="comment">// method 请求方法</span></span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// res =&gt; 拿到的只是响应体</span></span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url: <span class="string">'time.php'</span>,</span><br><span class="line">    type: <span class="string">'post'</span>,</span><br><span class="line">    <span class="comment">// 用于提交到服务端的参数，</span></span><br><span class="line">    <span class="comment">// 如果是 GET 请求就通过 url 传递</span></span><br><span class="line">    <span class="comment">// 如果是 POST 请求就通过请求体传递</span></span><br><span class="line">    data: &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'张三'</span> &#125;,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//服务端设置content-type</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url: <span class="string">'json.php'</span>,</span><br><span class="line">    type: <span class="string">'get'</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// res 会自动根据服务端响应的 content-type 自动转换为对象</span></span><br><span class="line">        <span class="comment">// 这是 jquery 内部实现的</span></span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//服务端不设置content-type，客户端设置dataType</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url: <span class="string">'json.php'</span>,</span><br><span class="line">    type: <span class="string">'get'</span>,</span><br><span class="line">    <span class="comment">// 设置的是请求参数</span></span><br><span class="line">    data: &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'张三'</span> &#125;,</span><br><span class="line">    <span class="comment">// 内部会调用JSON.parse()将服务端响应的数据转换为json对象</span></span><br><span class="line">    dataType: <span class="string">'json'</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//json.php</span></span><br><span class="line">&lt;?php</span><br><span class="line">$zhangsan = array(<span class="string">'name'</span> =&gt; <span class="string">'张三'</span>, <span class="string">'age'</span> =&gt; <span class="number">18</span>);</span><br><span class="line"><span class="comment">// 于情于理都应该设置 application/json</span></span><br><span class="line"><span class="comment">// header('Content-Type: application/json');</span></span><br><span class="line">echo json_encode($zhangsan);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关于dataType</span></span><br><span class="line"><span class="comment">//1.通过dataType选项还可以指定其他不同数据处理方式。可以指定 html、json、jsonp、script或者text。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.其中，text和xml类型返回的数据不会经过处理。数据仅仅简单的将XMLHttpRequest的responseText或responseXML属性传递给success回调函数，</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.如果指定为html类型，返回HTML文本，包含的script标签会在插入DOM时执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//4.如果指定script类型的话，把响应的结果当作JavaScript 执行，并将其当作纯文本返回</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//5.如果指定为json类型，则会把获取到的数据作为一个JavaScript对象来解析，并且把构建好的对象作为结果返回。为了实现这个目的，他首先尝试使用JSON.parse()。如果浏览器不支持，则使用一个函数来构建。JSON数据是一种能很方便通过JavaScript解析的结构化数据。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//6.如果获取的数据文件存放在远程服务器上（域名不同，也就是跨域获取数据），则需要使用jsonp类型。会自动在所请求的URL最后添加"?callback=?"。服务器端应当在JSON数据前加上回调函数名，以便完成一个有效的JSONP请求。</span></span><br><span class="line"></span><br><span class="line"><span class="string">'注意：我们必须确保网页服务器报告的MIME类型与我们选择的dataType所匹配。比如说，dataType为XML的话，服务器端就必须声明 text/xml 或者 application/xml 来获得一致的结果'</span></span><br></pre></td></tr></table></figure>
<h4 id="4-3-2-请求回调"><a href="#4-3-2-请求回调" class="headerlink" title="4.3.2. 请求回调"></a>4.3.2. 请求回调</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    url: <span class="string">'time.php'</span>,</span><br><span class="line">    type: <span class="string">'get'</span>,</span><br><span class="line">    beforeSend: <span class="function"><span class="keyword">function</span> (<span class="params">xhr</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 在所有发送请求的操作（open, send）之前执行</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'beforeSend'</span>, xhr)</span><br><span class="line">    &#125;,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 只有请求成功（状态码为200）才会执行这个函数</span></span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;,</span><br><span class="line">    error: <span class="function"><span class="keyword">function</span> (<span class="params">xhr</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 隐藏 loading</span></span><br><span class="line">        <span class="comment">// 只有请求不正常（状态码不为200）才会执行</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'error'</span>, xhr)</span><br><span class="line">    &#125;,</span><br><span class="line">    complete: <span class="function"><span class="keyword">function</span> (<span class="params">xhr</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 不管是成功还是失败都是完成，都会执行这个 complete 函数</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'complete'</span>, xhr)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="4-3-3-get-和-post"><a href="#4-3-3-get-和-post" class="headerlink" title="4.3.3. $.get  和  $.post"></a>4.3.3. <code>$.get</code>  和  <code>$.post</code></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$.get(<span class="string">'json.php'</span>, &#123; <span class="attr">id</span>: <span class="number">1</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$.post(<span class="string">'json.php'</span>, &#123; <span class="attr">id</span>: <span class="number">1</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$.getJSON(<span class="string">'json.php'</span>, &#123; <span class="attr">id</span>: <span class="number">1</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="4-3-4-全局事件处理"><a href="#4-3-4-全局事件处理" class="headerlink" title="4.3.4. 全局事件处理"></a>4.3.4. 全局事件处理</h4><p>​    <a href="http://www.jquery123.com/category/ajax/global-ajax-event-handlers/" target="_blank" rel="noopener">http://www.jquery123.com/category/ajax/global-ajax-event-handlers/</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.ajaxStart(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;&#125;)</span><br><span class="line">.ajaxStop(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    .loading &#123;</span><br><span class="line">        display: none;</span><br><span class="line">        position: fixed;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;div class="loading"&gt;正在玩命加载中...&lt;/</span>div&gt;</span><br><span class="line">&lt;button id=<span class="string">"btn"</span>&gt;请求&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="jquery.js"&gt;&lt;/</span>script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	$(<span class="built_in">document</span>).ajaxStart(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 只要有 ajax 请求发生 就会执行</span></span><br><span class="line">        $(<span class="string">'.loading'</span>).fadeIn()</span><br><span class="line">        <span class="comment">// 显示加载提示</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'注意即将要开始请求了'</span>)</span><br><span class="line">	&#125;).ajaxStop(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 只要有 ajax 请求结束 就会执行</span></span><br><span class="line">        $(<span class="string">'.loading'</span>).fadeOut()</span><br><span class="line">        <span class="comment">// 结束提示</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'请求结束了'</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">    $(<span class="string">'#btn'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $.get(<span class="string">'time.php'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-3-5-nprogress的使用"><a href="#4-3-5-nprogress的使用" class="headerlink" title="4.3.5 nprogress的使用"></a>4.3.5 nprogress的使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"../nprogress.css"</span>&gt; </span><br><span class="line">&lt;script src=<span class="string">"../nprogress.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;script src=<span class="string">"../jquery.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;button id=<span class="string">"btn"</span>&gt;请求&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">$(document).ajaxStart(function () &#123;</span></span><br><span class="line"><span class="regexp">    NProgress.start()</span></span><br><span class="line"><span class="regexp">&#125;).ajaxStop(function () &#123;</span></span><br><span class="line"><span class="regexp">    NProgress.done()</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">$('#btn').on('click', function () &#123;</span></span><br><span class="line"><span class="regexp">    $.get('time.php')</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br></pre></td></tr></table></figure>
<h4 id="4-3-6-案例"><a href="#4-3-6-案例" class="headerlink" title="4.3.6 案例"></a>4.3.6 案例</h4><h5 id="案例1：省市联动"><a href="#案例1：省市联动" class="headerlink" title="案例1：省市联动"></a>案例1：省市联动</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">##1 select.html</span><br><span class="line">&lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line">    &lt;label&gt;</span><br><span class="line">        省：&lt;select id=<span class="string">"province"</span>&gt;</span><br><span class="line">        &lt;option&gt;请选择省...&lt;<span class="regexp">/option&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>select&gt;</span><br><span class="line">    &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">    &lt;label&gt;</span></span><br><span class="line"><span class="regexp">        市：&lt;select id="city"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;option&gt;请选择市...&lt;/</span>option&gt;</span><br><span class="line">        &lt;<span class="regexp">/select&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>label&gt;</span><br><span class="line">    &lt;label&gt;</span><br><span class="line">        县：&lt;select id=<span class="string">"county"</span>&gt;</span><br><span class="line">        &lt;option&gt;请选择县...&lt;<span class="regexp">/option&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>select&gt;</span><br><span class="line">    &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line">&lt;style type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">    #container&#123;</span><br><span class="line">        width: <span class="number">500</span>px;</span><br><span class="line">        min-height: <span class="number">300</span>px;</span><br><span class="line">        background-color: lightgreen;</span><br><span class="line">        margin: auto;</span><br><span class="line">        text-align: center;</span><br><span class="line">        padding: <span class="number">10</span>px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">    </span></span><br><span class="line"><span class="regexp">    </span></span><br><span class="line"><span class="regexp">$(function()&#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ 公用方法</span></span><br><span class="line"><span class="regexp">    function queryData(obj,callback)&#123;</span></span><br><span class="line"><span class="regexp">        $.ajax(&#123;</span></span><br><span class="line"><span class="regexp">            type:'get',</span></span><br><span class="line"><span class="regexp">            url:'http:/</span><span class="regexp">/localhost/</span>summary/select.php<span class="string">',</span></span><br><span class="line"><span class="string">            data:obj,</span></span><br><span class="line"><span class="string">            dataType:'</span>json<span class="string">',</span></span><br><span class="line"><span class="string">            success:function(data)&#123;</span></span><br><span class="line"><span class="string">                callback(data);</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // 加载省级数据</span></span><br><span class="line"><span class="string">    queryData(&#123;</span></span><br><span class="line"><span class="string">        flag:1</span></span><br><span class="line"><span class="string">    &#125;,function(data)&#123;</span></span><br><span class="line"><span class="string">        var option = '</span><span class="string">';</span></span><br><span class="line"><span class="string">        $.each(data,function(i,e)&#123;</span></span><br><span class="line"><span class="string">            option += '</span>&lt;option value=<span class="string">"'+e.id+'"</span>&gt;<span class="string">'+e.province+'</span>&lt;<span class="regexp">/option&gt;';</span></span><br><span class="line"><span class="regexp">        &#125;);</span></span><br><span class="line"><span class="regexp">        $("#province").append(option);</span></span><br><span class="line"><span class="regexp">    &#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    $('#province').change(function()&#123;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ $("#city").find('option:gt(0)').remove();</span></span><br><span class="line"><span class="regexp">        $("#city option:gt(0)").remove();</span></span><br><span class="line"><span class="regexp">        queryData(&#123;</span></span><br><span class="line"><span class="regexp">            flag:2,</span></span><br><span class="line"><span class="regexp">            pId:$(this).val()</span></span><br><span class="line"><span class="regexp">        &#125;,function(data)&#123;</span></span><br><span class="line"><span class="regexp">            var option = '';</span></span><br><span class="line"><span class="regexp">            $.each(data,function(i,e)&#123;</span></span><br><span class="line"><span class="regexp">                option += '&lt;option value="'+e.id+'"&gt;'+e.city+'&lt;/</span>option&gt;<span class="string">';</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string">            $("#city").append(option);</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    $('#city').change(function()&#123;</span><br><span class="line">        <span class="comment">// $("#city").find('option:gt(0)').remove();</span></span><br><span class="line">        $(<span class="string">"#county option:gt(0)"</span>).remove();</span><br><span class="line">        queryData(&#123;</span><br><span class="line">            flag:<span class="number">3</span>,</span><br><span class="line">            cId:$(<span class="keyword">this</span>).val()</span><br><span class="line">        &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> option = <span class="string">''</span>;</span><br><span class="line">            $.each(data,<span class="function"><span class="keyword">function</span>(<span class="params">i,e</span>)</span>&#123;</span><br><span class="line">                option += <span class="string">'&lt;option value="'</span>+e.id+<span class="string">'"&gt;'</span>+e.county+<span class="string">'&lt;/option&gt;'</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            $(<span class="string">"#county"</span>).append(option);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">##2 select.php</span><br><span class="line">&lt;?php </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    省市县后台数据接口</span></span><br><span class="line"><span class="comment">    接口调用规则：</span></span><br><span class="line"><span class="comment">    1、参数一：flag，用来区分请求的是省市县中间的那种数据（1：省，2：市；3：县）</span></span><br><span class="line"><span class="comment">    2、参数二：选择省的时候传递pId,选择市的时候传递cId</span></span><br><span class="line"><span class="comment">    http://localhost/select.php?flag=1&amp;pId=23</span></span><br><span class="line"><span class="comment">    http://localhost/select.php?flag=1&amp;cd=2345</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// include('./selectdata.php');</span></span><br><span class="line">    <span class="comment">// 引入数据文件</span></span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'./selectdata.php'</span>);</span><br><span class="line">    <span class="comment">// 省市县数据来自selectdata.php文件</span></span><br><span class="line">    $province = $provinceJson;</span><br><span class="line">    $city = $cityJson;</span><br><span class="line">    $county = $countyJson;</span><br><span class="line"></span><br><span class="line">    $flag = $_GET[<span class="string">'flag'</span>];</span><br><span class="line">    <span class="comment">// 省级数据</span></span><br><span class="line">    <span class="keyword">if</span>($flag == <span class="number">1</span>)&#123;</span><br><span class="line">        echo json_encode($province);</span><br><span class="line">    <span class="comment">// 市级数据</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>($flag == <span class="number">2</span>)&#123;</span><br><span class="line">        $pId = $_GET[<span class="string">'pId'</span>];</span><br><span class="line">        $cityData = array();</span><br><span class="line">        foreach ($city <span class="keyword">as</span> $value) &#123;</span><br><span class="line">            <span class="keyword">if</span>($value-&gt;id == $pId)&#123;</span><br><span class="line">                <span class="comment">// 直辖市</span></span><br><span class="line">                array_push($cityData,$value);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>($value-&gt;parent == $pId)&#123;</span><br><span class="line">                <span class="comment">// 非直辖市</span></span><br><span class="line">                array_push($cityData,$value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        echo json_encode($cityData);</span><br><span class="line">    <span class="comment">// 县级数据</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>($flag == <span class="number">3</span>)&#123;</span><br><span class="line">        $cId = $_GET[<span class="string">'cId'</span>];</span><br><span class="line">        $countyData = array();</span><br><span class="line">        foreach ($county <span class="keyword">as</span> $value) &#123;</span><br><span class="line">            <span class="keyword">if</span>($value-&gt;parent == $cId)&#123;</span><br><span class="line">                array_push($countyData,$value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        echo json_encode($countyData);</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br><span class="line">    </span><br><span class="line">##3 selectdata.php见具体文件</span><br></pre></td></tr></table></figure>
<h5 id="案例2：获取天气"><a href="#案例2：获取天气" class="headerlink" title="案例2：获取天气"></a>案例2：获取天气</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">##1 weather.html</span><br><span class="line">&lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line">    城市名称：&lt;input type=<span class="string">"text"</span> id=<span class="string">"city"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"button"</span> value=<span class="string">"查询"</span> id=<span class="string">"query"</span>&gt;</span><br><span class="line">    &lt;div id=<span class="string">"info"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;style type="text/</span>css<span class="string">"&gt;</span></span><br><span class="line"><span class="string">    #container&#123;</span></span><br><span class="line"><span class="string">        width: 500px;</span></span><br><span class="line"><span class="string">        min-height: 300px;</span></span><br><span class="line"><span class="string">        margin: auto;</span></span><br><span class="line"><span class="string">        background-color: lightgreen;</span></span><br><span class="line"><span class="string">        text-align: center;</span></span><br><span class="line"><span class="string">        padding: 10px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    li&#123;list-style: none;&#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">    $(function()&#123;</span></span><br><span class="line"><span class="string">    // Promise</span></span><br><span class="line">    $("#query").click(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> city = $(<span class="string">"#city"</span>).val();</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type:<span class="string">'get'</span>,</span><br><span class="line">            url:<span class="string">'./citycode.php'</span>,</span><br><span class="line">            data:&#123;<span class="attr">cityName</span>:city&#125;,</span><br><span class="line">            dataType:<span class="string">'json'</span>,</span><br><span class="line">            success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                <span class="comment">// 如果第二次ajax请求依赖于第一次请求结果，那么第二次请求必须放到回调函数的内部</span></span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    type:<span class="string">'get'</span>,</span><br><span class="line">                    url:<span class="string">'./cityweather.php'</span>,</span><br><span class="line">                    data:&#123;<span class="attr">cityCode</span>:data.cityCode&#125;,</span><br><span class="line">                    dataType:<span class="string">'json'</span>,</span><br><span class="line">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                        data = data.retData;</span><br><span class="line">                        <span class="keyword">var</span> tag = <span class="string">'&lt;ul&gt;风向：'</span>+data.WD+<span class="string">'&lt;li&gt;风级：'</span>+data.WS+<span class="string">'&lt;/li&gt;&lt;li&gt;海拔：'</span>+data.altitude+<span class="string">'&lt;/li&gt;&lt;li&gt;日期：'</span>+data.date+<span class="string">'&lt;/li&gt;&lt;li&gt;最高温度：'</span>+data.h_tmp+<span class="string">'&lt;/li&gt;&lt;li&gt;最低温度：'</span>+data.l_tmp+<span class="string">'&lt;/li&gt;&lt;li&gt;平均温度：'</span>+data.temp+<span class="string">'&lt;/li&gt;&lt;li&gt;日出时间：'</span>+data.sunrise+<span class="string">'&lt;/li&gt;&lt;li&gt;日落时间：'</span>+data.sunset+<span class="string">'&lt;/li&gt;&lt;li&gt;经度：'</span>+data.longitude+<span class="string">'&lt;/li&gt;&lt;li&gt;维度：'</span>+data.latitude+<span class="string">'&lt;/li&gt;&lt;/ul&gt;'</span>;</span><br><span class="line">                        $(<span class="string">"#info"</span>).html(tag);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">##2 citycode.php</span></span><br><span class="line"><span class="regexp">&lt;?php</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 接口的作用：根据城市名称查询城市编码</span></span><br><span class="line"><span class="regexp">$cityName = $_GET['cityName'];</span></span><br><span class="line"><span class="regexp">if($cityName == '北京')&#123;</span></span><br><span class="line"><span class="regexp">	echo '&#123;"cityCode":"101010100"&#125;';</span></span><br><span class="line"><span class="regexp">&#125;else if($cityName == '上海')&#123;</span></span><br><span class="line"><span class="regexp">	echo '&#123;"cityCode":"101020100"&#125;';</span></span><br><span class="line"><span class="regexp">&#125;else if($cityName == '广州')&#123;</span></span><br><span class="line"><span class="regexp">	echo '&#123;"cityCode":"101280101"&#125;';</span></span><br><span class="line"><span class="regexp">&#125;else if($cityName == '深圳')&#123;</span></span><br><span class="line"><span class="regexp">	echo '&#123;"cityCode":"101280601"&#125;';</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">##3 cityweather.php</span></span><br><span class="line"><span class="regexp">&lt;?php</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ ----------------------------------------------------</span></span><br><span class="line"><span class="regexp">$cityCode = $_GET['cityCode'];</span></span><br><span class="line"><span class="regexp">if($cityCode == '101010100')&#123;</span></span><br><span class="line"><span class="regexp">	echo '&#123;"errNum":0,"errMsg":"success","retData":&#123;"city":"\u5317\u4eac","pinyin":"beijing","citycode":"101010100","date":"15-12-29","time":"18:00","postCode":"100000","longitude":116.391,"latitude":39.904,"altitude":"33","weather":"\u973e","temp":"-4","l_tmp":"","h_tmp":"-4","WD":"\u65e0\u6301\u7eed\u98ce\u5411","WS":"\u5fae\u98ce(&lt;10km\/h)","sunrise":"07:35","sunset":"16:57"&#125;&#125;';</span></span><br><span class="line"><span class="regexp">&#125;else if($cityCode == '101020100')&#123;</span></span><br><span class="line"><span class="regexp">	echo '&#123;"errNum":0,"errMsg":"success","retData":&#123;"city":"\u4e0a\u6d77","pinyin":"shanghai","citycode":"101020100","date":"15-12-29","time":"18:00","postCode":"200000","longitude":121.445,"latitude":31.213,"altitude":"19","weather":"\u591a\u4e91","temp":"5","l_tmp":"","h_tmp":"5","WD":"\u4e1c\u98ce","WS":"\u5fae\u98ce(&lt;10km\/h)","sunrise":"06:51","sunset":"17:00"&#125;&#125;';</span></span><br><span class="line"><span class="regexp">&#125;else if($cityCode == '101280101')&#123;</span></span><br><span class="line"><span class="regexp">	echo '&#123;"errNum":0,"errMsg":"success","retData":&#123;"city":"\u5e7f\u5dde","pinyin":"guangzhou","citycode":"101280101","date":"15-12-29","time":"18:00","postCode":"510000","longitude":113.265,"latitude":23.108,"altitude":"43","weather":"\u5c0f\u96e8","temp":"11","l_tmp":"","h_tmp":"11","WD":"\u65e0\u6301\u7eed\u98ce\u5411","WS":"\u5fae\u98ce(&lt;10km\/h)","sunrise":"07:06","sunset":"17:50"&#125;&#125;';</span></span><br><span class="line"><span class="regexp">&#125;else if($cityCode == '101280601')&#123;</span></span><br><span class="line"><span class="regexp">	echo '&#123;"errNum":0,"errMsg":"success","retData":&#123;"city":"\u6df1\u5733","pinyin":"shenzhen","citycode":"101280601","date":"15-12-29","time":"18:00","postCode":"518001","longitude":114.109,"latitude":22.544,"altitude":"40","weather":"\u9634","temp":"14","l_tmp":"","h_tmp":"14","WD":"\u65e0\u6301\u7eed\u98ce\u5411","WS":"\u5fae\u98ce(&lt;10km\/h)","sunrise":"07:02","sunset":"17:48"&#125;&#125;';</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-跨域"><a href="#5-跨域" class="headerlink" title="5.跨域"></a>5.跨域</h2><h3 id="5-1-相关概念"><a href="#5-1-相关概念" class="headerlink" title="5.1. 相关概念"></a>5.1. 相关概念</h3><p>​    同源策略是浏览器的一种安全策略，所谓同源是指  <strong>域名，协议，端口完全相同</strong> ，只有同源的地址才可以相互通过AJAX 的方式请求。<br>​    同源或者不同源说的是两个地址之间的关系，不同源地址之间请求我们称之为跨域请求</p>
<p>​    什么是同源？例如：<a href="http://www.example.com/detail.html" target="_blank" rel="noopener">http://www.example.com/detail.html</a> 与一下地址对比</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://api.example.com/detail.html 不同源 域名不同</span><br><span class="line">https://www.example.com/detail.html 不同源 协议不同</span><br><span class="line">http://www.example.com:8080/detail.html 不同源 端口不同</span><br><span class="line">http://api.example.com:8080/detail.html 不同源 域名、端口不同</span><br><span class="line">https://api.example.com/detail.html 不同源 协议、域名不同</span><br><span class="line">https://www.example.com:8080/detail.html 不同源 端口、协议不同</span><br><span class="line">http://www.example.com/other.html 同源 只是目录不同</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// 当前页面访问地址：http://day-12.io/11-cross-domain.html</span></span><br><span class="line">    <span class="comment">// 希望被AJAX的地址：http://locally.uieee.com/categories</span></span><br><span class="line">    <span class="comment">// 这两个地址之间 协议相同 端口相同 域名不同 所以是两个不同源的地址</span></span><br><span class="line">    <span class="comment">// 同源策略指的就是：不同源地址之间，默认不能相互发送AJAX请求</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不同源地址之间如果需要相互请求，必须服务端和客户端配合才能完成</span></span><br><span class="line">    $.get(<span class="string">'http://locally.uieee.com/categories'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  	  <span class="built_in">console</span>.log(res)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="comment">//No 'Access-Control-Allow-Origin' header is present on the requested resource</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-2-解决方案"><a href="#5-2-解决方案" class="headerlink" title="5.2. 解决方案"></a>5.2. 解决方案</h3><p>​    现代化的 Web 应用中肯定会有不同源的现象，所以必然要解决这个问题，从而实现跨域请求。</p>
<h4 id="5-2-1-发送跨域请求的方式"><a href="#5-2-1-发送跨域请求的方式" class="headerlink" title="5.2.1 发送跨域请求的方式"></a>5.2.1 发送跨域请求的方式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">##1. img</span><br><span class="line"><span class="comment">// 可以发送不同源地址之间的请求</span></span><br><span class="line"><span class="comment">// 无法拿到响应结果</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">img.src = <span class="string">'http://locally.uieee.com/categories'</span></span><br><span class="line"></span><br><span class="line">## 2. link</span><br><span class="line"><span class="comment">// 可以发送不同源地址之间的请求</span></span><br><span class="line"><span class="comment">// 无法拿到响应结果</span></span><br><span class="line"><span class="keyword">var</span> link = <span class="built_in">document</span>.createElement(<span class="string">'link'</span>)</span><br><span class="line">link.rel = <span class="string">'stylesheet'</span></span><br><span class="line">link.href = <span class="string">'http://locally.uieee.com/categories'</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(link)</span><br><span class="line"></span><br><span class="line">## 3. script</span><br><span class="line"><span class="comment">// 可以发送不同源地址之间的请求</span></span><br><span class="line"><span class="comment">// 能够借助js的回调间接拿到结果</span></span><br><span class="line"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">script.src = <span class="string">'http://localhost/time2.php'</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(script) <span class="comment">// 开始发起请求</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于请求的回调</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//time2.php</span></span><br><span class="line">&lt;?php</span><br><span class="line">header(<span class="string">'Content-Type: application/javascript'</span>);</span><br><span class="line">$json = json_encode(array(</span><br><span class="line">  <span class="string">'time'</span> =&gt; time()</span><br><span class="line">));</span><br><span class="line"><span class="comment">// 在 JSON 格式的字符串外面包裹了一个函数的调用，</span></span><br><span class="line"><span class="comment">// 返回的结果就变成了一段 JS 代码</span></span><br><span class="line">echo <span class="string">"foo(&#123;$json&#125;)"</span>;</span><br></pre></td></tr></table></figure>
<h4 id="5-2-1-JSONP"><a href="#5-2-1-JSONP" class="headerlink" title="5.2.1. JSONP"></a>5.2.1. JSONP</h4><p>​    JSON with Padding，是一种借助于 script 标签发送跨域请求的技巧。<br>​    其原理就是在客户端借助 script 标签请求服务端的一个动态网页（php 文件），服务端的这个动态网页返回一段带有函数调用的 JavaScript 全局函数调用的脚本，将原本需要返回给客户端的数据传递进去。<br>​    以后绝大多数情况都是采用 JSONP 的手段完成不同源地址之间的跨域请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//客户端 http://www.zce.me/users-list.html</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">msg</span>)</span>&#123; <span class="built_in">console</span>.log(msg) &#125;	</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="http:/</span><span class="regexp">/api.zce.me/u</span>sers.php<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">## script标签中的async表示异步的意思，但是在使用JSONP的时候不论有没有用异步，都建议将带有回调方法的js写在jsonp的js代码之前，以保证结果回来之后请求的回调函数已经存在。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//服务端 http://api.zce.me/users.php 返回的结果</span></span><br><span class="line">header(<span class="string">'Content-Type: application/javascript'</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"foo(['我', '是', '你', '原', '本', '需', '要', '的', '数', '据'])"</span>;</span><br></pre></td></tr></table></figure>
<p>​    总结一下：由于 XMLHttpRequest 无法发送不同源地址之间的跨域请求，所以我们必须要另寻他法，script 这种方案就是我们最终选择的方式，我们把这种方式称之为 JSONP。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JSONP存在的问题：</span></span><br><span class="line"><span class="number">1.</span>JSONP需要服务端配合，服务端按照客户端的要求返回一段JavaScript调用客户端的函数</span><br><span class="line"><span class="number">2.</span>只能发送GET请求</span><br><span class="line"></span><br><span class="line">注意：JSONP用的是script标签，和AJAX提供的XMLHttpRequest没有任何关系！！！</span><br></pre></td></tr></table></figure>
<h4 id="5-2-3-为每次请求创建一个函数"><a href="#5-2-3-为每次请求创建一个函数" class="headerlink" title="5.2.3.为每次请求创建一个函数"></a>5.2.3.为每次请求创建一个函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">##1.客户端</span><br><span class="line"><span class="keyword">var</span> funcName = <span class="string">'haha_'</span> + <span class="built_in">Date</span>.now() + <span class="built_in">Math</span>.random().toString().substr(<span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">script.src = <span class="string">'http://api.zce.me/users.php?callback='</span> + funcName</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(script)</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>[funcName] = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'1111'</span>, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">##2.服务端</span><br><span class="line">&lt;?php</span><br><span class="line">$data = <span class="string">"['我', '是', '你', '原', '本', '需', '要', '的', '数', '据']"</span>;</span><br><span class="line"><span class="keyword">if</span> (empty($_GET[<span class="string">'callback'</span>])) &#123;</span><br><span class="line">  header(<span class="string">'Content-Type: application/json'</span>);</span><br><span class="line">  echo $data;</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果客户端采用的是 script 标记对我发送的请求</span></span><br><span class="line"><span class="comment">// 一定要返回一段 JavaScript</span></span><br><span class="line">header(<span class="string">'Content-Type: application/javascript'</span>);</span><br><span class="line">$callback_name = $_GET[<span class="string">'callback'</span>];</span><br><span class="line">echo <span class="string">"typeof &#123;$callback_name&#125; === 'function' &amp;&amp; &#123;$callback_name&#125;(&#123;$data&#125;)"</span>;</span><br></pre></td></tr></table></figure>
<h4 id="5-2-4-JSONP的封装"><a href="#5-2-4-JSONP的封装" class="headerlink" title="5.2.4 JSONP的封装"></a>5.2.4 JSONP的封装</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonp</span> (<span class="params">url, params, callback</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//随机生成一个方法</span></span><br><span class="line">    <span class="keyword">var</span> funcName = <span class="string">'jsonp_'</span> + <span class="built_in">Date</span>.now() + <span class="built_in">Math</span>.random().toString().substr(<span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> params === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> tempArr = []</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">            <span class="keyword">var</span> value = params[key]</span><br><span class="line">            tempArr.push(key + <span class="string">'='</span> + value)</span><br><span class="line">        &#125;</span><br><span class="line">        params = tempArr.join(<span class="string">'&amp;'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">    script.src = url + <span class="string">'?'</span> + params + <span class="string">'&amp;callback='</span> + funcName</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>[funcName] = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        callback(data)</span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">window</span>[funcName]</span><br><span class="line">        <span class="built_in">document</span>.body.removeChild(script)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jsonp(<span class="string">'http://api.zce.me/users.php'</span>, &#123; <span class="attr">id</span>: <span class="number">123</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">jsonp(<span class="string">'http://api.zce.me/users.php'</span>, &#123; <span class="attr">id</span>: <span class="number">123</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="5-2-5-jQuery-中使用-JSONP-就是将-dataType-设置为-jsonp"><a href="#5-2-5-jQuery-中使用-JSONP-就是将-dataType-设置为-jsonp" class="headerlink" title="5.2.5 jQuery 中使用 JSONP 就是将 dataType 设置为 jsonp"></a>5.2.5 jQuery 中使用 JSONP 就是将 dataType 设置为 jsonp</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">##1.发送ajax请求</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: <span class="string">'http://localhost/jsonp/server.php'</span>,</span><br><span class="line">        dataType: <span class="string">'jsonp'</span>,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">##2.server.php</span></span><br><span class="line"><span class="regexp">&lt;?php</span></span><br><span class="line"><span class="regexp">$conn = mysqli_connect('localhost', 'root', '123456', 'demo');</span></span><br><span class="line"><span class="regexp">$query = mysqli_query($conn, 'select * from users');</span></span><br><span class="line"><span class="regexp">while ($row = mysqli_fetch_assoc($query)) &#123;</span></span><br><span class="line"><span class="regexp">  $data[] = $row;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">if (empty($_GET['callback'])) &#123;</span></span><br><span class="line"><span class="regexp">  header('Content-Type: application/</span>json<span class="string">');</span></span><br><span class="line"><span class="string">  echo json_encode($data);</span></span><br><span class="line"><span class="string">  exit();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">// 如果客户端采用的是 script 标记对我发送的请求</span></span><br><span class="line"><span class="string">// 一定要返回一段 JavaScript</span></span><br><span class="line"><span class="string">header('</span>Content-Type: application/javascript<span class="string">');</span></span><br><span class="line"><span class="string">$result = json_encode($data);</span></span><br><span class="line"><span class="string">$callback_name = $_GET['</span>callback<span class="string">'];</span></span><br><span class="line"><span class="string">echo "typeof &#123;$callback_name&#125; === '</span><span class="function"><span class="keyword">function</span>' &amp;&amp; </span>&#123;$callback_name&#125;(&#123;$result&#125;)<span class="string">";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">##3.注意点，jquery中可以自定义等号后的回调函数的名字以及等号前面的参数名字</span></span><br><span class="line"><span class="string"> 1.jsonp:'cb',  jsonp属性的作用就是自定义参数名字（callback=abc 这里的名字指的是等号前面的键，后端根据这个键获取方法名，jquery的默认参数名称是callback）</span></span><br><span class="line"><span class="string"> 2.jsonpCallback:'abc',  这个属性的作用就是自定义回调函数的名字（callback=abc ，这里的名字指的是等号后面的值）</span></span><br></pre></td></tr></table></figure>
<h4 id="5-2-6-JSONP案例"><a href="#5-2-6-JSONP案例" class="headerlink" title="5.2.6 JSONP案例"></a>5.2.6 JSONP案例</h4><h5 id="a-百度搜索词"><a href="#a-百度搜索词" class="headerlink" title="a) 百度搜索词"></a>a) 百度搜索词</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">#container&#123;</span><br><span class="line">    width: <span class="number">400</span>px;</span><br><span class="line">    min-height: <span class="number">300</span>px;</span><br><span class="line">    background-color: lightgreen;</span><br><span class="line">    margin: auto;</span><br><span class="line">    text-align: center;</span><br><span class="line">    padding: <span class="number">10</span>px;</span><br><span class="line">&#125;</span><br><span class="line">#container ul&#123;</span><br><span class="line">	margin: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">#container li&#123;</span><br><span class="line">    list-style: none;</span><br><span class="line">    background-color: lightGray;</span><br><span class="line">    text-align: left;</span><br><span class="line">    padding-left: <span class="number">45</span>px;</span><br><span class="line">    height: <span class="number">25</span>px;</span><br><span class="line">    line-height: <span class="number">25</span>px;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;div id="container"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;input type="text" name="keyword" id="keyword"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;input type="button" value="搜索" id="query"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div id="info"&gt;&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">$(function()&#123;</span></span><br><span class="line"><span class="regexp">    $("#keyword").keyup(function()&#123;</span></span><br><span class="line"><span class="regexp">        var kw = $(this).val();</span></span><br><span class="line"><span class="regexp">        $.ajax(&#123;</span></span><br><span class="line"><span class="regexp">            url:'https:/</span><span class="regexp">/sp0.baidu.com/</span><span class="number">5</span>a1Fazu8AA54nxGko9WTAnF6hhy/su<span class="string">',</span></span><br><span class="line"><span class="string">            jsonp:'</span>cb<span class="string">',</span></span><br><span class="line"><span class="string">            data:&#123;wd:kw&#125;,</span></span><br><span class="line"><span class="string">            dataType:'</span>jsonp<span class="string">',</span></span><br><span class="line"><span class="string">            success:function(data)&#123;</span></span><br><span class="line"><span class="string">                var sug = data.s;</span></span><br><span class="line"><span class="string">                var tag = '</span>&lt;ul&gt;<span class="string">';</span></span><br><span class="line"><span class="string">                $.each(sug,function(i,e)&#123;</span></span><br><span class="line"><span class="string">                    tag += '</span>&lt;li&gt;<span class="string">'+e+'</span>&lt;<span class="regexp">/li&gt;';</span></span><br><span class="line"><span class="regexp">                &#125;);</span></span><br><span class="line"><span class="regexp">                tag += '&lt;/u</span>l&gt;<span class="string">';</span></span><br><span class="line"><span class="string">                $("#info").html(tag);</span></span><br><span class="line"><span class="string">                $("#info").find('</span>li<span class="string">').hover(function()&#123;</span></span><br><span class="line"><span class="string">                    $(this).css('</span>backgroundColor<span class="string">','</span>lightblue<span class="string">');</span></span><br><span class="line"><span class="string">                &#125;,function()&#123;</span></span><br><span class="line"><span class="string">                    $(this).css('</span>backgroundColor<span class="string">','</span>lightgray<span class="string">');</span></span><br><span class="line"><span class="string">                &#125;);</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>
<h5 id="b-查询天气"><a href="#b-查询天气" class="headerlink" title="b) 查询天气"></a>b) 查询天气</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个服务器地址不稳定</span></span><br><span class="line">&lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line">     &lt;select id=<span class="string">"city"</span>&gt;</span><br><span class="line">         &lt;option value=<span class="string">"101010100"</span>&gt;北京&lt;<span class="regexp">/option&gt;</span></span><br><span class="line"><span class="regexp">         &lt;option value="101020100"&gt;上海&lt;/</span>option&gt;</span><br><span class="line">         &lt;option value=<span class="string">"101280101"</span>&gt;广州&lt;<span class="regexp">/option&gt;</span></span><br><span class="line"><span class="regexp">         &lt;option value="101280601"&gt;深圳&lt;/</span>option&gt;</span><br><span class="line">     &lt;<span class="regexp">/select&gt;</span></span><br><span class="line"><span class="regexp">     &lt;input type="button" value="查询" id="query"&gt;</span></span><br><span class="line"><span class="regexp">     &lt;div id="info"&gt;&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"> &lt;script type="text/</span>javascript<span class="string">" src="</span>./jquery.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;script type="</span>text/javascript<span class="string">" src="</span>./template.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;script type="</span>text/html<span class="string">" id="</span>weather<span class="string">"&gt;</span></span><br><span class="line"><span class="string">        &#123;&#123;if weather&#125;&#125;</span></span><br><span class="line"><span class="string">            &#123;&#123;each weather as value&#125;&#125;</span></span><br><span class="line"><span class="string">                &lt;div&gt;</span></span><br><span class="line"><span class="string">                    &lt;span&gt;日期：&#123;&#123;value.date&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">					</span></span><br><span class="line"><span class="string">					&#123;&#123;if value.info&#125;&#125;</span></span><br><span class="line"><span class="string">						&lt;ul&gt;</span></span><br><span class="line"><span class="string">							&lt;li&gt;白天天气&#123;&#123;value.info.day[1]&#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="string">							&lt;li&gt;白天温度&#123;&#123;value.info.day[2]&#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="string">							&lt;li&gt;白天风向&#123;&#123;value.info.day[3]&#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="string">							&lt;li&gt;白天风速&#123;&#123;value.info.day[4]&#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="string">						&lt;/ul&gt;</span></span><br><span class="line"><span class="string">						&lt;ul&gt;</span></span><br><span class="line"><span class="string">							&lt;li&gt;夜间天气&#123;&#123;value.info.night[1]&#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="string">							&lt;li&gt;夜间温度&#123;&#123;value.info.night[2]&#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="string">							&lt;li&gt;夜间风向&#123;&#123;value.info.night[3]&#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="string">							&lt;li&gt;夜间风速&#123;&#123;value.info.night[4]&#125;&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="string">						&lt;/ul&gt;</span></span><br><span class="line"><span class="string">                      &#123;&#123;/if&#125;&#125;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &#123;&#123;/each&#125;&#125;</span></span><br><span class="line"><span class="string">        &#123;&#123;/if&#125;&#125;</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">        $(function()&#123;</span></span><br><span class="line">            $("#query").click(function()&#123;</span><br><span class="line">                <span class="keyword">var</span> code = $(<span class="string">'#city'</span>).val();</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    url : <span class="string">'http://tq.360.cn/api/weatherquery/querys'</span>,</span><br><span class="line">                    data:&#123;<span class="attr">app</span>:<span class="string">'tq360'</span>,<span class="attr">code</span>:code&#125;,</span><br><span class="line">                    jsonp:<span class="string">'_jsonp'</span>,</span><br><span class="line">                    dataType:<span class="string">'jsonp'</span>,</span><br><span class="line">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                        <span class="keyword">var</span> html = template(<span class="string">'weather'</span>,data);</span><br><span class="line">                        $(<span class="string">'#info'</span>).html(html);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="5-2-7-CORS"><a href="#5-2-7-CORS" class="headerlink" title="5.2.7. CORS"></a>5.2.7. CORS</h4><p>​    Cross Origin Resource Share，跨域资源共享。这种方案无需客户端作出任何变化（客户端不用改代码），只是在被请求的服务端响应的时候添加一个 Access- Control-Allow-Origin 的响应头，表示这个资源是否允许指定域请求。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//服务端代码	</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn = mysqli_connect(<span class="string">'localhost'</span>, <span class="string">'root'</span>, <span class="string">'123456'</span>, <span class="string">'demo'</span>);</span><br><span class="line">$query = mysqli_query($conn, <span class="string">'select * from users'</span>);</span><br><span class="line"><span class="keyword">while</span> ($row = mysqli_fetch_assoc($query)) &#123;</span><br><span class="line">	$data[] = $row;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 一行代码搞定</span></span><br><span class="line"><span class="comment">// 允许跨域请求</span></span><br><span class="line">header(<span class="string">'Access-Control-Allow-Origin: *'</span>);</span><br><span class="line">header(<span class="string">'Content-Type: application/json'</span>);</span><br><span class="line"><span class="keyword">echo</span> json_encode($data);</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//客户端代码</span></span><br><span class="line">$.get(<span class="string">'http://localhost/cors.php'</span>, &#123;&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(res)</span> </span>&#123;</span><br><span class="line">	console.log(res) </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="6-XMLHttpRequest-2-0"><a href="#6-XMLHttpRequest-2-0" class="headerlink" title="6.XMLHttpRequest 2.0"></a>6.XMLHttpRequest 2.0</h2><blockquote>
<p>暂作了解，无需着重看待<br>更易用，更强大</p>
</blockquote>
<h3 id="6-1-onload-onprogress"><a href="#6-1-onload-onprogress" class="headerlink" title="6.1. onload / onprogress"></a>6.1. onload / onprogress</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//onload和onprogress 是html5中规定的</span></span><br><span class="line"><span class="comment">//onload        readyState === 4</span></span><br><span class="line"><span class="comment">//onprogress    readyState === 3</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'./time.php'</span>)</span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	console.log(this.readyState)</span><br><span class="line">&#125;</span><br><span class="line">xhr.onprogress = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	console.log(this.readyState)</span><br><span class="line">&#125;</span><br><span class="line">xhr.send(<span class="keyword">null</span>)</span><br></pre></td></tr></table></figure>
<h3 id="6-2-FormData"><a href="#6-2-FormData" class="headerlink" title="6.2. FormData"></a>6.2. FormData</h3><p>​    以前 AJAX 只能提交字符串，现在可以提交 二进制 的数据</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/29/我的第一篇博客/" data-id="cjp3r5mug0000aclyomzaxs9g" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/29/hello-world/" class="article-date">
  <time datetime="2018-11-29T13:07:24.134Z" itemprop="datePublished">2018-11-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/29/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/29/hello-world/" data-id="cjp3r5myv0001aclyndd7vz0r" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/11/29/我的第一篇博客/">(no title)</a>
          </li>
        
          <li>
            <a href="/2018/11/29/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>